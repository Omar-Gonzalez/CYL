"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!1===!!window.CanvasRenderingContext2D&&(alert("Your browser doesn't suppor Canvas 2D rendering context - Please consider get a recent version of Firefox, Chrome or Safari"),console.error("Your browser doesn't suppor Canvas 2D rendering context. Please consider get a recent version of Firefox, Chrome or Safari")),window.requestAnimationFrame||(alert("Your browser doesn't suppor the requestAnimationFrame API - Please, get a recent version of Firefox, Chrome or Safari"),console.error("Your browser doesn't suppor equestAnimationFrame API. Please consider get a recent version of Firefox, Chrome or Safari")),window.addEventListener||(alert("Your browser doesn't suppor the addEventListener API - Please, get a recent version of Firefox, Chrome or Safari"),console.error("Your browser doesn't suppor addEventListener API - Please consider get a recent version of Firefox, Chrome or Safari")),console.log(requestAnimationFrame),function(e,t){function i(){if(!r){r=!0;for(var e=0;e<s.length;e++)s[e].fn.call(window,s[e].ctx);s=[]}}function n(){"complete"===document.readyState&&i()}e=e||"docReady";var s=[],r=!1,a=!1;(t=t||window)[e]=function(e,t){if("function"!=typeof e)throw new TypeError("callback for docReady(fn) must be a function");r?setTimeout(function(){e(t)},1):(s.push({fn:e,ctx:t}),"complete"===document.readyState?setTimeout(i,1):a||(document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):(document.attachEvent("onreadystatechange",n),window.attachEvent("onload",i)),a=!0))}}("docReady",window),Array.prototype.min=function(e){if(0===this.length)return null;if(1===this.length)return this[0];e=e||Math.min;for(var t=this[0],i=1;i<this.length;i++)t=e(this[i],t);return t},Array.prototype.max=function(e){if(0===this.length)return null;if(1===this.length)return this[0];e=e||Math.max;for(var t=this[0],i=1;i<this.length;i++)t=e(this[i],t);return t},Number.prototype.between=function(e,t){return this>e&&this<t},window.SCREEN=function(){var e=10,t=[100,100];e=window.innerWidth/100;var i=void 0,n=void 0;if(t){var s=(100-t[1])/2;document.getElementById("screen").style.marginTop=s+"%",i=t[0]+"%",n=t[1]+"%"}return{pixelSize:e,screen:{width:i,height:n}}},window.addEventListener("resize",function(){window.SCREEN()});var Input=function(){function e(){_classCallCheck(this,e),this._registerKeyDown()}return _createClass(e,[{key:"_registerKeyDown",value:function(){var e=this;window.addEventListener("keydown",function(t){return e._filterKeyDown(t)}),window.addEventListener("click",function(t){return e.click(null,t)})}},{key:"click",value:function(e,t){e&&(this.mouseAction=e),"function"==typeof this.mouseAction&&void 0!==t?this.mouseAction(t):console.warn("CYL: Click action must be a function")}},{key:"_filterKeyDown",value:function(e){"ArrowUp"!==e.key&&"ArrowUp"!==e.code&&38!==e.keyCode||this.arrowUp(),"ArrowDown"!==e.key&&"ArrowDown"!==e.code&&40!==e.keyCode||this.arrowDown(),"ArrowLeft"!==e.key&&"ArrowLeft"!==e.code&&37!==e.keyCode||this.arrowLeft(),"ArrowRight"!==e.key&&"ArrowRight"!==e.code&&39!==e.keyCode||this.arrowRight()," "!==e.key&&"Space"!==e.code&&32!==e.keyCode||this.spaceBar(),"Escape"!==e.key&&"Escape"!==e.code&&27!==e.keyCode||this.escape(),"a"!==e.key&&"A"!==e.key&&"KeyA"!==e.code&&65!==e.keyCode||this.a(),"s"!==e.key&&"S"!==e.key&&"KeyS"!==e.code&&83!==e.keyCode||this.s(),"d"!==e.key&&"D"!==e.key&&"KeyD"!==e.code&&68!==e.keyCode||this.d(),"f"!==e.key&&"F"!==e.key&&"KeyF"!==e.code&&70!==e.keyCode||this.f(),"p"!==e.key&&"P"!==e.key&&"KeyP"!==e.code&&80!==e.keyCode||this.p()}},{key:"p",value:function(e){e&&(this.pAction=e),"function"==typeof this.pAction?this.pAction():this._callBackTypeError()}},{key:"f",value:function(e){e&&(this.fAction=e),"function"==typeof this.fAction?this.fAction():this._callBackTypeError()}},{key:"d",value:function(e){e&&(this.dAction=e),"function"==typeof this.dAction?this.dAction():this._callBackTypeError()}},{key:"s",value:function(e){e&&(this.sAction=e),"function"==typeof this.sAction?this.sAction():this._callBackTypeError()}},{key:"a",value:function(e){e&&(this.aAction=e),"function"==typeof this.aAction?this.aAction():this._callBackTypeError()}},{key:"escape",value:function(e){e&&(this.escapeAction=e),"function"==typeof this.escapeAction?this.escapeAction():this._callBackTypeError()}},{key:"spaceBar",value:function(e){e&&(this.spaceBarAction=e),"function"==typeof this.spaceBarAction?this.spaceBarAction():this._callBackTypeError()}},{key:"arrowUp",value:function(e){e&&(this.arrowUpAction=e),"function"==typeof this.arrowUpAction?this.arrowUpAction():this._callBackTypeError()}},{key:"arrowDown",value:function(e){e&&(this.keyDownAction=e),"function"==typeof this.keyDownAction?this.keyDownAction():this._callBackTypeError()}},{key:"arrowLeft",value:function(e){e&&(this.keyLeftAction=e),"function"==typeof this.keyLeftAction?this.keyLeftAction():this._callBackTypeError()}},{key:"arrowRight",value:function(e){e&&(this.keyRightAction=e),"function"==typeof this.keyRightAction?this.keyRightAction():this._callBackTypeError()}},{key:"_callBackTypeError",value:function(){console.warn("CYL: Input action requires a function")}}]),e}(),Scene=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),Array.isArray(t)?t.length<1?console.error("CYL:[Exception]Need at least one sprite to initialize a scene"):(this.screen=document.getElementById("screen"),this.canvas=document.getElementById("game"),this.ctx=this.canvas.getContext("2d"),this.sprites=t,this._defineCanvasDimensions()):console.error("CYL:[Exception]Update method requires an array of sprites")}return _createClass(e,[{key:"_defineCanvasDimensions",value:function(){var e=this;this.screen.style.width=SCREEN().screen.width,this.screen.style.height=SCREEN().screen.height,this.canvas.width=this.screen.offsetWidth,this.canvas.height=this.screen.offsetHeight,window.addEventListener("resize",function(){e.screen.style.width=SCREEN().screen.width,e.screen.style.height=SCREEN().screen.height,e.canvas.width=e.screen.offsetWidth,e.canvas.height=e.screen.offsetHeight})}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.frame.width,this.frame.height);for(var e=0;e<this.sprites.length;e++)this.sprites[e].renderedX=[],this.sprites[e].renderedY=[]}},{key:"_renderPixel",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.ctx.fillStyle=t.color,this.ctx.fillRect(t.x+i,t.y+n,SCREEN().pixelSize,SCREEN().pixelSize),e.renderedX.push(t.x+i),e.renderedY.push(t.y+n)}},{key:"_renderShapeWith",value:function(e){for(var t=0;t<e.framePixels.length;t++)this._renderPixel(e,e.framePixels[t],e.x,e.y)}},{key:"_sortShapeFrameWith",value:function(e){e.tickCounter>e.tick&&(e.tickCounter=0,e.currentFrameIndex++,e.currentFrameIndex>=e.frameCount&&(e.currentFrameIndex=0)),e.tickCounter++,this._renderShapeWith(e)}},{key:"_renderBitmapFrame",value:function(e){this.ctx.drawImage(e.currentFrame,e.x,e.y,e.currentFrame.width,e.currentFrame.height)}},{key:"_sortBitmapFrameWith",value:function(e){e.tickCounter>e.tick&&(e.tickCounter=0,e.currentFrameIndex++,e.currentFrameIndex>=e.frameCount&&(e.currentFrameIndex=0)),e.tickCounter++,this._renderBitmapFrame(e)}},{key:"_renderLabelSprite",value:function(e){this.ctx.font=e.ctxFont,this.ctx.fillStyle=e.color,e.width=this.ctx.measureText(e.text).width,this.ctx.fillText(e.text,e.x,e.y)}},{key:"_renderDialogue",value:function(e){for(var t=0;t<e.options.length;t++)this._renderLabelSprite(e.options[t])}},{key:"update",value:function(){this.clear();for(var e=0;e<this.sprites.length;e++)"shape"===this.sprites[e].kind&&this._sortShapeFrameWith(this.sprites[e]),"bitmap"===this.sprites[e].kind&&this._sortBitmapFrameWith(this.sprites[e]),"label"===this.sprites[e].kind&&this._renderLabelSprite(this.sprites[e]),"dialogue"===this.sprites[e].kind&&this._renderDialogue(this.sprites[e])}},{key:"setSprites",value:function(e){Array.isArray(e)?this.sprites=e:console.error("CYL:[Exception]Update method requires an array of sprites")}},{key:"frame",get:function(){return{width:parseInt(this.canvas.width),height:parseInt(this.canvas.height)}}},{key:"assets",get:function(){return{spriteCount:this.sprites.length,sprites:this.sprites}}}]),e}(),ShapeSprite=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;_classCallCheck(this,e),void 0===t&&console.warn("CYL:Warning, no name identifier for sprite"),4===n&&console.warn("CYL:Warning, default 4 sprite size"),void 0!==i?Array.isArray(i)?(this.kind="shape",this.name=t,this.spriteFrames=[],this.width=n,this.x=a,this.y=o,this.currentFrameIndex=0,this.tick=s,this.tickCounter=0,this.shapes=i,this.activeAnimation="",this.renderedX=[],this.renderedY=[],this.contactGroup=r,this.setAnimation()):console.error("CYL:[Exception]Shape object must be an array"):console.error("CYL:[Exception]You need a shape to initialize a sprite")}return _createClass(e,[{key:"setAnimation",value:function(e){this.spriteFrames=[],this.activeAnimation=void 0===e?"idle":e;for(var t=0,i=0;i<this.shapes.length;i++)this.shapes[i].set===this.activeAnimation&&(this.mapFrameWith(this.shapes[i].shape),t++);0!==t?this.frameCount=t:console.error("CYL:[Exception]No active sets in srite")}},{key:"mapFrameWith",value:function(e){for(var t=[],i=0,n=0,s=0;s<e.length;s++)t.push({x:i,y:n,color:e[s]}),i+=SCREEN().pixelSize,(s+1)%this.width==0&&(n+=SCREEN().pixelSize,i=0);this.spriteFrames.push(t)}},{key:"inContactWith",value:function(e){var t=!1,i=!1;return(this.bounds.maxX.between(e.bounds.minX,e.bounds.maxX)||this.bounds.minX.between(e.bounds.minX,e.bounds.maxX))&&(t=!0),(this.bounds.maxY.between(e.bounds.minY,e.bounds.maxY)||this.bounds.minY.between(e.bounds.minY,e.bounds.maxY))&&(i=!0),!0===t&&!0===i?{inContact:!0,contactWith:this.name+" in contact with "+e.name}:{inContact:!1}}},{key:"inCollisionWith",value:function(e){var t=!1,i=!1;return(this.bounds.maxX.between(e.bounds.minX,e.bounds.maxX)||this.bounds.minX.between(e.bounds.minX,e.bounds.maxX))&&(t=!0),(this.bounds.maxY.between(e.bounds.minY,e.bounds.maxY)||this.bounds.minY.between(e.bounds.minY,e.bounds.maxY))&&(i=!0),!0===t&&!0===i?{inCollision:!0,collisionWith:this.name+" in collision with "+e.name}:{inCollision:!1}}},{key:"bounds",get:function(){return{maxX:this.renderedX.max(),minX:this.renderedX.min(),maxY:this.renderedY.max(),minY:this.renderedY.min()}}},{key:"framePixels",get:function(){return this.spriteFrames[this.currentFrameIndex]}},{key:"frames",get:function(){return this.spriteFrames}}]),e}(),BitmapSprite=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;_classCallCheck(this,e),void 0===t&&console.warn("CYL:Warning, no name identifier for sprite"),Array.isArray(i)?void 0!==i?(50===s&&50===n&&console.warn("CYL:Warning, bitmap sprite dimensions set to default 50x50"),this.kind="bitmap",this.name=t,this.bitmaps=i,this.width=n,this.height=s,this.x=o,this.y=h,this.tick=r,this.tickCounter=0,this.frameCount=0,this.currentFrameIndex=0,this.contactGroup=a,this.setAnimation()):console.error("CYL:[Exception]You need at least one bitmap to initialize a sprite"):console.error("CYL:[Exception]Bitmaps object must be an array")}return _createClass(e,[{key:"setAnimation",value:function(e){this.spriteFrames=[],this.activeAnimation=void 0===e?"idle":e;for(var t=0,i=0;i<this.bitmaps.length;i++)if(this.bitmaps[i].set===this.activeAnimation){var n=new Image;n.src=this.bitmaps[i].src,n.width=this.width,n.height=this.height,this.spriteFrames.push(n),t++}0!==t?this.frameCount=t:console.error("CYL:[Exception]No active frames in srite")}},{key:"inContactWith",value:function(e){var t=!1,i=!1;return(this.bounds.maxX.between(e.bounds.minX,e.bounds.maxX)||this.bounds.minX.between(e.bounds.minX,e.bounds.maxX))&&(t=!0),(this.bounds.maxY.between(e.bounds.minY,e.bounds.maxY)||this.bounds.minY.between(e.bounds.minY,e.bounds.maxY))&&(i=!0),!0===t&&!0===i?{inContact:!0,contactWith:this.name+" in contact with "+e.name}:{inContact:!1}}},{key:"inCollisionWith",value:function(e){var t=!1,i=!1;return(this.bounds.maxX.between(e.bounds.minX,e.bounds.maxX)||this.bounds.minX.between(e.bounds.minX,e.bounds.maxX))&&(t=!0),(this.bounds.maxY.between(e.bounds.minY,e.bounds.maxY)||this.bounds.minY.between(e.bounds.minY,e.bounds.maxY))&&(i=!0),!0===t&&!0===i?{inCollision:!0,collisionWith:this.name+" in collision with "+e.name}:{inCollision:!1}}},{key:"setDimension",value:function(e,t){this.spriteFrames=[];for(var i=0;i<this.bitmaps.length;i++)if(this.bitmaps[i].set===this.activeAnimation){var n=new Image;n.src=this.bitmaps[i].src,n.width=e,n.height=e,this.spriteFrames.push(n)}}},{key:"bounds",get:function(){return{maxX:this.width+this.x,minX:this.x,minY:this.y,maxY:this.height+this.y}}},{key:"currentFrame",get:function(){return this.spriteFrames[this.currentFrameIndex]}},{key:"frames",get:function(){return this.spriteFrames}}]),e}(),LabelSprite=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Verdana",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",a=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:5),o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:30;_classCallCheck(this,e),void 0===t&&console.error("CYL:[Exception] You need a string to initalize a label sprite"),this.kind="label",this.text=t,this.font=n,this.size=i+"px",this.weight=s,this.color=r,this.width,this.x=a,this.y=o}return _createClass(e,[{key:"ctxFont",get:function(){return this.weight+" "+this.size+" "+this.font}},{key:"frame",get:function(){return{width:parseInt(this.width),height:parseInt(this.size)}}}]),e}(),Dialogue=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:55,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"menu",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"orange",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:300;_classCallCheck(this,e),Array.isArray(t)?(this.name=n,this.kind="dialogue",this.x=o,this.y=h,this.lineSpace=i,this.labels=t,this.focusIndex=0,this.focusSize=parseInt(t[0].size)*a+"px",this.focusColor=s,this.defaultFontSize=t[0].size,this.defaultColor=r,this._placeGrid()):console.error("CYL:[Exception]Labbels object must be an array of LabelSprites")}return _createClass(e,[{key:"_placeGrid",value:function(){for(var e=0;e<this.labels.length;e++)this.labels[e].y=this.y+this.lineSpace+parseInt(e*this.lineSpace),this.labels[e].x=this.labels[e].x+this.x;this._processFocus()}},{key:"_processFocus",value:function(){for(var e=0;e<this.labels.length;e++)e===this.focusIndex?(this.labels[e].size=this.focusSize,this.labels[e].color=this.focusColor):(this.labels[e].size=this.defaultFontSize,this.labels[e].color=this.defaultColor)}},{key:"setFocus",value:function(e){e<0||e>this.labels.length?console.warn("CYL:[Warning] - The focus you are setting is out of range"):(this.focusIndex=e,this._processFocus())}},{key:"focusDown",value:function(){this.focusIndex>=this.labels.length-1?this.focusIndex=0:this.focusIndex++,this._processFocus()}},{key:"focusUp",value:function(){0>=this.focusIndex?this.focusIndex=this.labels.length-1:this.focusIndex--,this._processFocus()}},{key:"options",get:function(){return this.labels}}]),e}(),Game=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),Array.isArray(t)?(0===scene&&console.warn("CYL:Default initial scene with index 0 is being loaded"),this.scenes=t,this.active=i,this.shouldUpdate=!0,this.setActiveScene(),this.run=this.run.bind(this)):console.error("CYL:[Exception]Game requires an array of scenes")}return _createClass(e,[{key:"setActiveScene",value:function(e){void 0!==e&&(this.active=e),this.activeScene=this.scenes[this.active]}},{key:"run",value:function(){this.shouldUpdate&&(this.activeScene.update(),this.detectContact()),window.requestAnimationFrame(this.run)}},{key:"pause",value:function(){this.shouldUpdate?this.shouldUpdate=!1:this.shouldUpdate=!0}},{key:"spriteNamed",value:function(e){for(var t=0;t<this.activeScene.sprites.length;t++)if(this.activeScene.sprites[t].name===e)return this.activeScene.sprites[t]}},{key:"spritesNamed",value:function(e){return this.activeScene.sprites.filter(function(t){return t.name===e})}},{key:"detectContact",value:function(){var e=this.spriteNamed("cat").inContactWith(this.spriteNamed("enemy"));e.inContact&&console.log(e.contactWith)}},{key:"detectCollision",value:function(){var e=this.spriteNamed("player").inCollisionWith(this.spriteNamed("enemy")).inCollision;e.inCollision&&console.log(e.collisionWith)}},{key:"assets",get:function(){return{scenes:this.scenes,activeScene:this.activeScene}}}]),e}(),idle1={set:"idle",shape:["transparent","white","white","transparent","red","white","red","white","white","white","white","white","red","red","red","white","transparent","white","white","transparent"]},idle2={set:"idle",shape:["transparent","white","white","transparent","white","red","white","red","white","white","white","white","white","red","red","red","transparent","white","white","transparent"]},moving1={set:"moving",shape:["transparent","white","white","transparent","white","red","white","red","white","white","white","white","white","red","red","red","white","white","white","white"]},moving2={set:"moving",shape:["white","white","white","white","red","white","red","white","white","white","white","white","red","red","red","white","transparent","white","white","transparent"]},player=new ShapeSprite("player",[idle1,idle2,moving1,moving2],4,20,"A"),eIdle1={set:"idle",shape:["orange","transparent","transparent","orange","orange","transparent","transparent","orange","transparent","orange","orange","transparent","transparent","transparent","transparent","transparent","transparent","transparent","transparent","transparent"]},eIdle2={set:"idle",shape:["transparent","transparent","transparent","transparent","transparent","transparent","transparent","transparent","transparent","orange","orange","transparent","orange","transparent","transparent","orange","orange","transparent","transparent","orange"]},enemy=new ShapeSprite("enemy",[eIdle1,eIdle2],4,10,"A"),catImg={set:"idle",src:"assets/cat-bat.png"},catImg2={set:"idle",src:"assets/cat-bat-alt.png"},cat=new BitmapSprite("cat",[catImg,catImg2],100,100),title=new LabelSprite("CYL:Game Development Tools",17),newGame=new LabelSprite("New Game"),start=new LabelSprite("Start"),options=new LabelSprite("Options"),dialogue=new Dialogue([newGame,start,options]),scene=new Scene([player,enemy,cat,title,dialogue]),game=new Game([scene]);game.run(),player.x=scene.frame.width/2,player.y=scene.frame.height/2,enemy.x=scene.frame.width/3,enemy.y=scene.frame.height/3,cat.x=.7*scene.frame.width,cat.y=scene.frame.height/3,title.x=scene.frame.width/2-title.frame.width/2;var input=new Input;input.click(function(e){game.spriteNamed("cat").x=e.clientX,game.spriteNamed("cat").y=e.clientY}),input.arrowUp(function(){game.spriteNamed("player").y=game.spriteNamed("player").y-20,game.spriteNamed("menu").focusUp()}),input.arrowDown(function(){game.spriteNamed("player").y=game.spriteNamed("player").y+20,game.spriteNamed("menu").focusDown()}),input.arrowLeft(function(){game.spriteNamed("player").x=game.spriteNamed("player").x-20}),input.arrowRight(function(){game.spriteNamed("player").x=game.spriteNamed("player").x+20});
//# sourceMappingURL=cyl.min.js.map