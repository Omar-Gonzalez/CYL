"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function placeInvadersWith(e){for(var t=e.frame.width/4,i=e.frame.height/6,n=0,s=0,o=0;o<12;o++){var r=new ShapeSprite("invader",[invShape.idle1,invShape.idle2,invShape.moving1,invShape.moving2],8,15);r.x=t*o,4!==o&&8!==o||(n++,s=0),r.x=t*s,r.y=i*n,s++,game.getSceneNamed("level").addSprite(r)}}function shoot(){var e=new ShapeSprite("bullet",[bulletShape.frame1,bulletShape.frame2],1,4),t=game.spriteNamed("player");e.x=t.x,e.y=t.y,game.getSceneNamed("level").addSprite(e)}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(){var e=" - Please consider getting a recent version of Firefox, Chrome or Safari";window.console.error&&window.console.warn||(alert("Your browser doesn't suppor the console.error and console.warn debug tools"+e),console.error("Your browser doesn't suppor the console.error and console.warn debug tools"+e)),!1===!!window.CanvasRenderingContext2D&&(alert("Your browser doesn't suppor Canvas 2D rendering context"+e),console.error("Your browser doesn't suppor Canvas 2D rendering context"+e)),window.requestAnimationFrame||(alert("Your browser doesn't suppor the requestAnimationFrame API"+e),console.error("Your browser doesn't suppor equestAnimationFrame API"+e)),window.addEventListener||(alert("Your browser doesn't suppor the addEventListener API"+e),console.error("Your browser doesn't suppor addEventListener API"+e))}(),console.log(requestAnimationFrame),function(e,t){function i(){if(!o){o=!0;for(var e=0;e<s.length;e++)s[e].fn.call(window,s[e].ctx);s=[]}}function n(){"complete"===document.readyState&&i()}e=e||"docReady";var s=[],o=!1,r=!1;(t=t||window)[e]=function(e,t){if("function"!=typeof e)throw new TypeError("callback for docReady(fn) must be a function");o?setTimeout(function(){e(t)},1):(s.push({fn:e,ctx:t}),"complete"===document.readyState?setTimeout(i,1):r||(document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):(document.attachEvent("onreadystatechange",n),window.attachEvent("onload",i)),r=!0))}}("docReady",window),Array.prototype.min=function(e){if(0===this.length)return null;if(1===this.length)return this[0];e=e||Math.min;for(var t=this[0],i=1;i<this.length;i++)t=e(this[i],t);return t},Array.prototype.max=function(e){if(0===this.length)return null;if(1===this.length)return this[0];e=e||Math.max;for(var t=this[0],i=1;i<this.length;i++)t=e(this[i],t);return t},Number.prototype.between=function(e,t){return this>e&&this<t},Number.prototype.positivity=function(){return this>0?"positive":"negative"},Number.prototype.getCloseTo=function(e,t){return this<e?this+t:this-t},Array.prototype.removeVal=function(e){for(var t=0;t<this.length;t++)this[t]===e&&(this.splice(t,1),t--);return this},Array.prototype.removeIndex=function(e){return this.splice(e,1),this};var Logger=function(){function e(){_classCallCheck(this,e),this.logs=[]}return _createClass(e,[{key:"print",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,s=this.logs[Symbol.iterator]();!(e=(n=s.next()).done);e=!0)log=n.value,console.log("CYL:Log - "+log)}catch(e){t=!0,i=e}finally{try{!e&&s.return&&s.return()}finally{if(t)throw i}}}},{key:"add",value:function(e){this.logs.push(e)}},{key:"delete",value:function(){this.logs=[]}},{key:"dump",get:function(){return this.logs}}]),e}(),Config=function(){function e(){_classCallCheck(this,e),this.predefinedPixel="l",this.screenKind="full",this.dimension=[100,100]}return _createClass(e,[{key:"setScreen",value:function(e,t){if(void 0!==e){void 0===t&&console.error("CYL:[Warning]CFG.setScreen no dimension parameter, dimesion will set to default 100x100"),this.dimension=t,this.screenKind=e;var i=document.getElementById("screen");i.style.width=this.dimension[0]+"px",i.style.height=this.dimension[1]+"px"}else console.error("CYL:[Exception]CFG.setScreen requires kind fixed | full | percentual] parameter")}},{key:"FONTSIZE",value:function(e){var t=document.getElementById("screen").offsetWidth;if("small"===e){if(t<768)return"12px";if(t>768&&t<1028)return"16px";if(t>1028)return"20px"}if("medium"===e){if(t<768)return"20px";if(t>768&&t<1028)return"40px";if(t>1028)return"50px"}if("large"===e){if(t<768)return"28px";if(t>768&&t<1028)return"50px";if(t>1028)return"70px"}}},{key:"DEVICE",get:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop"}},{key:"SCREEN",get:function(){var e=void 0,t=void 0,i=0;return"percentual"===this.screenKind&&(i=(100-this.dimension[1])/2,document.getElementById("screen").style.marginTop=i+"%",e=this.dimension[0]+"%",t=this.dimension[1]+"%"),"aspect-ratio"===this.screenKind&&(e=window.innerWidth,t=parseFloat(e/this.dimension[0]*this.dimension[1]),i=(window.innerHeight-t)/2,document.getElementById("screen").style.marginTop=i+"px",e+="px",t+="px"),"fixed"===this.screenKind&&(e=this.dimension[0]+"px",t=this.dimension[1]+"px","s"===this.predefinedPixel&&(this.pixelSize=document.getElementById("screen").offsetWidth/200),"m"===this.predefinedPixel&&(this.pixelSize=document.getElementById("screen").offsetWidth/150),"l"===this.predefinedPixel&&(this.pixelSize=document.getElementById("screen").offsetWidth/100)),"full"===this.screenKind&&(e="100%",t="100%"),{width:e,height:t,verticalMargin:i,horizontalMargin:(window.innerWidth-document.getElementById("game").offsetWidth)/2}}},{key:"PIXELSIZE",get:function(){return"s"===this.predefinedPixel&&(this.pixelSize=document.getElementById("screen").offsetWidth/200),"m"===this.predefinedPixel&&(this.pixelSize=document.getElementById("screen").offsetWidth/150),"l"===this.predefinedPixel&&(this.pixelSize=document.getElementById("screen").offsetWidth/100),this.pixelSize}}]),e}(),CFG=new Config,Action=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";_classCallCheck(this,e),"default"===t&&console.warn("CYL:Warning, Initialicing Action with default parameter"),this.kind=t,this.cycleX=!0,this.cycleY=!0,this.accelRatio=1.7,this.xCurrentSpeed=0,this.yCurrentSpeed=0,this.prevXSpeed=0,this.prevYSpeed=0,this.maxSpeedFactor=12}return _createClass(e,[{key:"computeX",value:function(e){if("default"===this.kind)return e;if("accel"===this.kind){e.positivity()!==this.prevXSpeed.positivity()&&(this.xCurrentSpeed=0),this.prevXSpeed=e;var t=void 0;return"positive"===e.positivity()?(t=e*this.maxSpeedFactor,this.xCurrentSpeed<t&&(this.xCurrentSpeed=this.xCurrentSpeed+e*this.accelRatio)):(t=-Math.abs(e*this.maxSpeedFactor),this.xCurrentSpeed>t&&(this.xCurrentSpeed=this.xCurrentSpeed+e*this.accelRatio)),this.xCurrentSpeed}return"shake"===this.kind?this.cycleX?(this.cycleX=!1,-Math.abs(this._shake(e))):(this.cycleX=!0,this._shake(e)):"shake-vertical"===this.kind?0:void 0}},{key:"computeY",value:function(e){if("default"===this.kind)return e;if("accel"===this.kind){e.positivity()!==this.prevYSpeed.positivity()&&(this.yCurrentSpeed=0),this.prevYSpeed=e;var t=void 0;return"positive"===e.positivity()?(t=e*this.maxSpeedFactor,this.yCurrentSpeed<t&&(this.yCurrentSpeed=this.yCurrentSpeed+e*this.accelRatio)):(t=-Math.abs(e*this.maxSpeedFactor),this.yCurrentSpeed>t&&(this.yCurrentSpeed=this.yCurrentSpeed+e*this.accelRatio)),this.yCurrentSpeed}return"shake"===this.kind?this.cycleY?(this.cycleY=!1,this._shake(e)):(this.cycleY=!0,-Math.abs(this._shake(e))):"shake-vertical"===this.kind?this.cycleY?(this.cycleY=!1,this._shake(e)):(this.cycleY=!0,-Math.abs(this._shake(e))):void 0}},{key:"_shake",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return Math.floor(Math.random()*e)+1}}]),e}(),MouseAction=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";_classCallCheck(this,e),"default"===t&&console.warn("CYL:Warning, Initializing Mouse Action with default parameter"),this.kind=t,this.movementRate=10,this.originX=0,this.originY=0,this.targetX=0,this.targetY=0,this.reachedTargetX=!1,this.reachedTargetY=!1}return _createClass(e,[{key:"computeX",value:function(e,t,i){return"default"===this.kind?e:"click-move"===this.kind?t.between(e-i.width/2,e+i.width/2)?(this.reachedTargetX=!0,t):t.getCloseTo(e,this.movementRate):"click-move-x"===this.kind?(this.targetX=e,this.originX=t,t.between(e-i.width/2,e+i.width/2)?(this.reachedTargetX=!0,t):t.getCloseTo(e,this.movementRate)):"click-move-y"===this.kind?t:void 0}},{key:"computeY",value:function(e,t,i){return"default"===this.kind?e:"click-move"===this.kind?t.between(e-i.height/2,e+i.height/2)?(this.reachedTargetY=!0,t):t.getCloseTo(e,this.movementRate):"click-move-x"===this.kind?t:"click-move-y"===this.kind?t.between(e-i.height/2,e+i.height/2)?(this.reachedTargetY=!0,t):t.getCloseTo(e,this.movementRate):void 0}},{key:"shouldKeepUpdating",get:function(){return"click-move-x"===this.kind&&this.reachedTargetX?(this.reachedTargetX=!1,!1):"click-move-y"===this.kind&&this.reachedTargetY?(this.reachedTargetY=!1,!1):!this.reachedTargetX||!this.reachedTargetY||(this.reachedTargetX=!1,this.reachedTargetY=!1,!1)}},{key:"vectorDirection",get:function(){return"click-move-x"===this.kind?this.originX<this.targetX:"click-move-y"===this.kind?this.originY<this.targetY:void 0}}]),e}(),Input=function(){function e(){_classCallCheck(this,e),this._registerKeyDown(),this.events=0}return _createClass(e,[{key:"_registerKeyDown",value:function(){var e=this;window.addEventListener("keydown",function(t){return e._filterKeyDown(t)}),document.getElementById("game").addEventListener(this.clickForDevice,function(t){return e.click(null,t)})}},{key:"click",value:function(e,t){if(e&&(this.mouseAction=e),"function"==typeof this.mouseAction&&void 0!==t){"mobile"===CFG.DEVICE&&(t.x=t.touches[0].clientX,t.y=t.touches[0].clientY);var i={};i.x=t.x-CFG.SCREEN.horizontalMargin,i.y=t.y-CFG.SCREEN.verticalMargin,this.mouseAction(i)}else console.warn("CYL: Click action must be a function")}},{key:"_filterKeyDown",value:function(e){"ArrowUp"!==e.key&&"ArrowUp"!==e.code&&38!==e.keyCode||this.arrowUp(null,!0),"ArrowDown"!==e.key&&"ArrowDown"!==e.code&&40!==e.keyCode||this.arrowDown(null,!0),"ArrowLeft"!==e.key&&"ArrowLeft"!==e.code&&37!==e.keyCode||this.arrowLeft(null,!0),"ArrowRight"!==e.key&&"ArrowRight"!==e.code&&39!==e.keyCode||this.arrowRight(null,!0)," "!==e.key&&"Space"!==e.code&&32!==e.keyCode||this.spaceBar(null,!0),"Escape"!==e.key&&"Escape"!==e.code&&27!==e.keyCode||this.escape(null,!0),"a"!==e.key&&"A"!==e.key&&"KeyA"!==e.code&&65!==e.keyCode||this.a(null,!0),"s"!==e.key&&"S"!==e.key&&"KeyS"!==e.code&&83!==e.keyCode||this.s(null,!0),"d"!==e.key&&"D"!==e.key&&"KeyD"!==e.code&&68!==e.keyCode||this.d(null,!0),"f"!==e.key&&"F"!==e.key&&"KeyF"!==e.code&&70!==e.keyCode||this.f(null,!0),"p"!==e.key&&"P"!==e.key&&"KeyP"!==e.code&&80!==e.keyCode||this.p(null,!0)}},{key:"p",value:function(e,t){e&&(this.pAction=e),void 0!==t&&("function"==typeof this.pAction?this.pAction():this._callBackTypeError())}},{key:"f",value:function(e,t){e&&(this.fAction=e),void 0!==t&&("function"==typeof this.fAction?this.fAction():this._callBackTypeError())}},{key:"d",value:function(e,t){e&&(this.dAction=e),void 0!==t&&("function"==typeof this.dAction?this.dAction():this._callBackTypeError())}},{key:"s",value:function(e,t){e&&(this.sAction=e),void 0!==t&&("function"==typeof this.sAction?this.sAction():this._callBackTypeError())}},{key:"a",value:function(e,t){e&&(this.aAction=e),void 0!==t&&("function"==typeof this.aAction?this.aAction():this._callBackTypeError())}},{key:"escape",value:function(e,t){e&&(this.escapeAction=e),void 0!==t&&("function"==typeof this.escapeAction?this.escapeAction():this._callBackTypeError())}},{key:"spaceBar",value:function(e,t){e&&(this.spaceBarAction=e),void 0!==t&&("function"==typeof this.spaceBarAction?this.spaceBarAction():this._callBackTypeError())}},{key:"arrowUp",value:function(e,t){e&&(this.arrowUpAction=e),void 0!==t&&("function"==typeof this.arrowUpAction?(this.events++,this.arrowUpAction()):this._callBackTypeError())}},{key:"arrowDown",value:function(e,t){e&&(this.keyDownAction=e),void 0!==t&&("function"==typeof this.keyDownAction?(this.events++,this.keyDownAction()):this._callBackTypeError())}},{key:"arrowLeft",value:function(e,t){e&&(this.keyLeftAction=e),void 0!==t&&("function"==typeof this.keyLeftAction?this.keyLeftAction():this._callBackTypeError())}},{key:"arrowRight",value:function(e,t){e&&(this.keyRightAction=e),void 0!==t&&("function"==typeof this.keyRightAction?this.keyRightAction():this._callBackTypeError())}},{key:"_callBackTypeError",value:function(){console.warn("CYL: Input action requires a function")}},{key:"clickForDevice",get:function(){return"desktop"===CFG.DEVICE?"click":"touchstart"}}]),e}(),Scene=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_classCallCheck(this,e),Array.isArray(i)?i.length<1?console.error("CYL:[Exception]Need at least one sprite to initialize a scene"):(this.name=t,this.screen=document.getElementById("screen"),this.canvas=document.getElementById("game"),this.ctx=this.canvas.getContext("2d"),this.sprites=i,this._defineCanvasDimensions()):console.error("CYL:[Exception]Update method requires an array of sprites")}return _createClass(e,[{key:"_defineCanvasDimensions",value:function(){var e=this;this.screen.style.width=CFG.SCREEN.width,this.screen.style.height=CFG.SCREEN.height,this.canvas.width=this.screen.offsetWidth,this.canvas.height=this.screen.offsetHeight,window.addEventListener("resize",function(){e.screen.style.width=CFG.SCREEN.width,e.screen.style.height=CFG.SCREEN.height,e.canvas.width=e.screen.offsetWidth,e.canvas.height=e.screen.offsetHeight})}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.frame.width,this.frame.height);for(var e=0;e<this.sprites.length;e++)this.sprites[e].renderedX=[],this.sprites[e].renderedY=[]}},{key:"_renderPixel",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.ctx.fillStyle=t.color,this.ctx.fillRect(t.x+i,t.y+n,CFG.PIXELSIZE,CFG.PIXELSIZE),e.renderedX.push(t.x+i),e.renderedY.push(t.y+n)}},{key:"_renderShapeWith",value:function(e){for(var t=0;t<e.framePixels.length;t++)this._renderPixel(e,e.framePixels[t],e.x,e.y)}},{key:"_sortShapeFrameWith",value:function(e){e.tickCounter>e.tick&&(e.tickCounter=0,e.currentFrameIndex++,e.currentFrameIndex>=e.frameCount&&(e.currentFrameIndex=0)),e.tickCounter++,this._renderShapeWith(e)}},{key:"_renderBitmapFrame",value:function(e){this.ctx.drawImage(e.currentFrame,e.x,e.y,e.currentFrame.width,e.currentFrame.height)}},{key:"_sortBitmapFrameWith",value:function(e){e.tickCounter>e.tick&&(e.tickCounter=0,e.currentFrameIndex++,e.currentFrameIndex>=e.frameCount&&(e.currentFrameIndex=0)),e.tickCounter++,this._renderBitmapFrame(e)}},{key:"_renderLabelSprite",value:function(e){this.ctx.font=e.ctxFont,this.ctx.fillStyle=e.color,e.width=this.ctx.measureText(e.text).width,this.ctx.fillText(e.text,e.x,e.y)}},{key:"_renderDialogue",value:function(e){for(var t=0;t<e.options.length;t++)this._renderLabelSprite(e.options[t])}},{key:"update",value:function(){this.clear();for(var e=0;e<this.sprites.length;e++)"shape"===this.sprites[e].kind&&this._sortShapeFrameWith(this.sprites[e]),"bitmap"===this.sprites[e].kind&&this._sortBitmapFrameWith(this.sprites[e]),"label"===this.sprites[e].kind&&this._renderLabelSprite(this.sprites[e]),"dialogue"===this.sprites[e].kind&&this._renderDialogue(this.sprites[e])}},{key:"setSprites",value:function(e){Array.isArray(e)?this.sprites=e:console.error("CYL:[Exception]Update method requires an array of sprites")}},{key:"addSprite",value:function(e){this.sprites.push(e)}},{key:"frame",get:function(){return{width:parseInt(this.canvas.width),height:parseInt(this.canvas.height)}}},{key:"assets",get:function(){return{spriteCount:this.sprites.length,sprites:this.sprites}}}]),e}(),ShapeSprite=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;_classCallCheck(this,e),void 0===t&&console.warn("CYL:Warning, no name identifier for sprite"),4===n&&console.warn("CYL:Warning, default 4 sprite size"),void 0!==i?Array.isArray(i)?(this.kind="shape",this.name=t,this.spriteFrames=[],this.width=n,this.x=r,this.y=c,this.currentFrameIndex=0,this.tick=s,this.tickCounter=0,this.shapes=i,this.activeAnimation="",this.renderedX=[],this.renderedY=[],this.contactGroup=o,this.action=null,this.constantUpdateInterval=";)",this.actionStoppedCB=null,this.setAnimation()):console.error("CYL:[Exception]Shape object must be an array"):console.error("CYL:[Exception]You need a shape to initialize a sprite")}return _createClass(e,[{key:"setAnimation",value:function(e){this.spriteFrames=[],this.activeAnimation=void 0===e?"idle":e;for(var t=0,i=0;i<this.shapes.length;i++)this.shapes[i].set===this.activeAnimation&&(this.mapFrameWith(this.shapes[i].shape),t++);0!==t?this.frameCount=t:console.error("CYL:[Exception]No active sets in srite")}},{key:"mapFrameWith",value:function(e){for(var t=[],i=0,n=0,s=0;s<e.length;s++)t.push({x:i,y:n,color:e[s]}),i+=CFG.PIXELSIZE,(s+1)%this.width==0&&(n+=CFG.PIXELSIZE,i=0);this.spriteFrames.push(t)}},{key:"inCollisionWith",value:function(e){var t=!1,i=!1;return(this.bounds.maxX.between(e.bounds.minX,e.bounds.maxX)||this.bounds.minX.between(e.bounds.minX,e.bounds.maxX))&&(t=!0),(this.bounds.maxY.between(e.bounds.minY,e.bounds.maxY)||this.bounds.minY.between(e.bounds.minY,e.bounds.maxY))&&(i=!0),!0===t&&!0===i}},{key:"updatePos",value:function(e,t){this.x=e,this.y=t}},{key:"actionWithVector",value:function(e,t){this.x=this.action.computeX(e)+this.x,this.y=this.action.computeY(t)+this.y}},{key:"mouseActionWithClick",value:function(e,t,i){this.x=this.mouseAction.computeX(e-this.frame.width/2,this.x,this.frame),this.y=this.mouseAction.computeY(t-this.frame.height/2,this.y,this.frame),this.actionIsRunning(null,!0),this.mouseAction.shouldKeepUpdating||(clearInterval(this.constantUpdateInterval),this.actionDidStop(null,!0))}},{key:"mouseActionUpdate",value:function(e,t){clearInterval(this.constantUpdateInterval),this.actionDidStart(null,!0);var i=this;this.constantUpdateInterval=setInterval(function(){i.mouseActionWithClick(e,t)},40)}},{key:"actionDidStop",value:function(e,t){e&&(this.actionStoppedCB=e),void 0!==t&&"function"==typeof this.actionStoppedCB&&this.actionStoppedCB()}},{key:"actionDidStart",value:function(e,t){e&&(this.actionStartCB=e),void 0!==t&&"function"==typeof this.actionStartCB&&this.actionStartCB()}},{key:"actionIsRunning",value:function(e,t){e&&(this.actionIsRunning=e),void 0!==t&&"function"==typeof this.actionIsRunning&&this.actionIsRunning()}},{key:"setAction",value:function(e){this.action=e}},{key:"setMouseAction",value:function(e){this.mouseAction=e}},{key:"_callBackTypeError",value:function(){console.warn("CYL: action cb requires a function")}},{key:"bounds",get:function(){return{maxX:this.renderedX.max(),minX:this.renderedX.min(),maxY:this.renderedY.max(),minY:this.renderedY.min()}}},{key:"frame",get:function(){return{width:parseInt(this.renderedX.max()-this.renderedX.min()),height:parseInt(this.renderedY.max()-this.renderedY.min())}}},{key:"framePixels",get:function(){return this.spriteFrames[this.currentFrameIndex]}},{key:"frames",get:function(){return this.spriteFrames}}]),e}(),BitmapSprite=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;_classCallCheck(this,e),void 0===t&&console.warn("CYL:Warning, no name identifier for sprite"),Array.isArray(i)?void 0!==i?(50===s&&50===n&&console.warn("CYL:Warning, bitmap sprite dimensions set to default 50x50"),this.kind="bitmap",this.name=t,this.bitmaps=i,this.width=n,this.height=s,this.x=c,this.y=a,this.tick=o,this.tickCounter=0,this.frameCount=0,this.currentFrameIndex=0,this.contactGroup=r,this.setAnimation()):console.error("CYL:[Exception]You need at least one bitmap to initialize a sprite"):console.error("CYL:[Exception]Bitmaps object must be an array")}return _createClass(e,[{key:"setAnimation",value:function(e){this.spriteFrames=[],this.activeAnimation=void 0===e?"idle":e;for(var t=0,i=0;i<this.bitmaps.length;i++)if(this.bitmaps[i].set===this.activeAnimation){var n=new Image;n.src=this.bitmaps[i].src,n.width=this.width,n.height=this.height,this.spriteFrames.push(n),t++}0!==t?this.frameCount=t:console.error("CYL:[Exception]No active frames in srite")}},{key:"inCollisionWith",value:function(e){var t=!1,i=!1;return(this.bounds.maxX.between(e.bounds.minX,e.bounds.maxX)||this.bounds.minX.between(e.bounds.minX,e.bounds.maxX))&&(t=!0),(this.bounds.maxY.between(e.bounds.minY,e.bounds.maxY)||this.bounds.minY.between(e.bounds.minY,e.bounds.maxY))&&(i=!0),!0===t&&!0===i}},{key:"setDimension",value:function(e,t){this.spriteFrames=[];for(var i=0;i<this.bitmaps.length;i++)if(this.bitmaps[i].set===this.activeAnimation){var n=new Image;n.src=this.bitmaps[i].src,n.width=e,n.height=e,this.spriteFrames.push(n)}}},{key:"updatePos",value:function(e,t){this.x=e,this.y=t}},{key:"actionWithVector",value:function(e,t){this.x=this.action.computeX(e)+this.x,this.y=this.action.computeY(t)+this.y}},{key:"mouseActionWithClick",value:function(e,t,i){this.x=this.mouseAction.computeX(e-this.frame.width/2,this.x,this.frame),this.y=this.mouseAction.computeY(t-this.frame.height/2,this.y,this.frame),this.actionIsRunning(null,!0),this.mouseAction.shouldKeepUpdating||(clearInterval(this.constantUpdateInterval),this.actionDidStop(null,!0))}},{key:"mouseActionUpdate",value:function(e,t){clearInterval(this.constantUpdateInterval),this.actionDidStart(null,!0);var i=this;this.constantUpdateInterval=setInterval(function(){i.mouseActionWithClick(e,t)},40)}},{key:"actionDidStop",value:function(e,t){e&&(this.actionStoppedCB=e),void 0!==t&&"function"==typeof this.actionStoppedCB&&this.actionStoppedCB()}},{key:"actionDidStart",value:function(e,t){e&&(this.actionStartCB=e),void 0!==t&&"function"==typeof this.actionStartCB&&this.actionStartCB()}},{key:"actionIsRunning",value:function(e,t){e&&(this.actionIsRunning=e),void 0!==t&&"function"==typeof this.actionIsRunning&&this.actionIsRunning()}},{key:"setAction",value:function(e){this.action=e}},{key:"setMouseAction",value:function(e){this.mouseAction=e}},{key:"_callBackTypeError",value:function(){console.warn("CYL: action cb requires a function")}},{key:"bounds",get:function(){return{maxX:this.width+this.x,minX:this.x,minY:this.y,maxY:this.height+this.y}}},{key:"currentFrame",get:function(){return this.spriteFrames[this.currentFrameIndex]}},{key:"frames",get:function(){return this.spriteFrames}}]),e}(),LabelSprite=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"medium",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Verdana",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",r=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:5),c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:30;_classCallCheck(this,e),void 0===t&&console.error("CYL:[Exception] You need a string to initalize a label sprite"),this.kind="label",this.text=t,this.font=n,this.fontSize=i,this.weight=s,this.color=o,this.width,this.x=r,this.y=c}return _createClass(e,[{key:"updatePos",value:function(e,t){this.x=e,this.y=t}},{key:"size",get:function(){return"small"===this.fontSize||"medium"===this.fontSize||"large"===this.fontSize?CFG.FONTSIZE(this.fontSize):this.fontSize+"px"}},{key:"ctxFont",get:function(){return this.weight+" "+this.size+" "+this.font}},{key:"frame",get:function(){return{width:parseInt(this.width),height:parseInt(this.size)}}}]),e}(),Dialogue=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:55,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"menu",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#6A1B9A",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1.5,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:10,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:10;_classCallCheck(this,e),Array.isArray(t)?(this.name=n,this.kind="dialogue",this.x=c,this.y=a,this.lineSpace=i,this.labels=t,this.focusIndex=0,this.focusSize=parseInt(t[0].size)*r+"px",this.focusColor=s,this.defaultFontSize=t[0].size,this.defaultColor=o,this._placeGrid()):console.error("CYL:[Exception]Labbels object must be an array of LabelSprites")}return _createClass(e,[{key:"_placeGrid",value:function(){for(var e=0;e<this.labels.length;e++)this.labels[e].y=this.y+this.lineSpace+parseInt(e*this.lineSpace),this.labels[e].x=this.labels[e].x+this.x;this._processFocus()}},{key:"_processFocus",value:function(){for(var e=0;e<this.labels.length;e++)e===this.focusIndex?this.labels[e].color=this.focusColor:this.labels[e].color=this.defaultColor}},{key:"setFocus",value:function(e){e<0||e>this.labels.length?console.warn("CYL:[Warning] - The focus you are setting is out of range"):(this.focusIndex=e,this._processFocus())}},{key:"focusDown",value:function(){this.focusIndex>=this.labels.length-1?this.focusIndex=0:this.focusIndex++,this._processFocus()}},{key:"focusUp",value:function(){0>=this.focusIndex?this.focusIndex=this.labels.length-1:this.focusIndex--,this._processFocus()}},{key:"updatePos",value:function(e,t){this.x=e,this.y=t,this._placeGrid()}},{key:"options",get:function(){return this.labels}}]),e}(),Pattern=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,e),void 0!==n&&void 0!==s||console.warn("CYL:[Warning] X and Y displacemente where set to default of 0"),this.scene=t,this.xMovement=n,this.yMovement=s,this.xProgression=0,this.yProgression=0,this.xMax=0,this.yMax=0,this.cycle=!0,this.applyFor=i,void 0===this.update&&console.error("CYL:[Exception]Pattern requires a update method to initialize")}return _createClass(e,[{key:"pos",get:function(){return{x:this.xMovement,y:this.yMovement}}}]),e}(),Game=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),Array.isArray(t)?(0===t.length&&console.warn("CYL:Default initial scene with index 0 is being loaded"),this.scenes=t,this.active=i,this.shouldUpdate=!0,this.patterns=[],this.onUpdateCb=null,this.setActiveScene(),this.run=this.run.bind(this)):console.error("CYL:[Exception]Game requires an array of scenes")}return _createClass(e,[{key:"setActiveScene",value:function(e){void 0!==e&&(this.active=e),this.activeScene=this.scenes[this.active]}},{key:"setActiveSceneNamed",value:function(e){var t=!0,i=!1,n=void 0;try{for(var s,o=this.scenes[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var r=s.value;r.name===e&&(this.activeScene=r)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"getSceneNamed",value:function(e){var t=!0,i=!1,n=void 0;try{for(var s,o=this.scenes[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){var r=s.value;if(r.name===e)return r}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"run",value:function(){this.shouldUpdate&&(this.updatePatterns(),this.activeScene.update(),null!==this.onUpdateCb&&this.onUpdateCb()),window.requestAnimationFrame(this.run)}},{key:"pause",value:function(){this.shouldUpdate?this.shouldUpdate=!1:this.shouldUpdate=!0}},{key:"onUpdate",value:function(e){"function"!=typeof e&&console.error("CYL:[Exception] contact methods must be a function"),this.onUpdateCb=e}},{key:"spriteNamed",value:function(e){for(var t=0;t<this.activeScene.sprites.length;t++)if(this.activeScene.sprites[t].name===e)return this.activeScene.sprites[t]}},{key:"spritesNamed",value:function(e){return this.activeScene.sprites.filter(function(t){return t.name===e})}},{key:"spritesWithKind",value:function(e){return this.activeScene.sprites.filter(function(t){return t.kind===e})}},{key:"removeSprite",value:function(e){for(var t=0;t<this.activeScene.sprites.length;t++)this.activeScene.sprites[t]===e&&this.activeScene.sprites.removeIndex(t)}},{key:"removeSpritesNamed",value:function(e){for(var t=0;t<this.activeScene.sprites.length;t++)this.activeScene.sprites[t].name===sprite.name&&this.activeScene.sprites.removeIndex(t)}},{key:"removeSpriteIndex",value:function(e){this.activeScene.sprites.removeIndex(e)}},{key:"addPatternToScene",value:function(e,t){var i={pattern:e,scene:t};this.patterns.push(i)}},{key:"updatePatterns",value:function(){for(var e=0;e<this.patterns.length;e++)if(this.patterns[e].pattern.scene===this.activeScene.name){this.patterns[e].pattern.update();for(var t=this.patterns[e].pattern.applyFor,i=0;i<this.spritesNamed(t).length;i++)this.spritesNamed(t)[i].x=this.spritesNamed(t)[i].x+this.patterns[e].pattern.pos.x,this.spritesNamed(t)[i].y=this.spritesNamed(t)[i].y+this.patterns[e].pattern.pos.y}}},{key:"assets",get:function(){return{scenes:this.scenes,activeScene:this.activeScene}}},{key:"numberOfActiveSprites",get:function(){return this.activeScene.sprites.length}}]),e}(),invShape={},bulletShape={},c={t:"transparent",p:"#6A1B9A",o:"#FF9800",r:"#FF5722"};bulletShape.frame1={set:"idle",shape:[c.r,c.o,c.r]},bulletShape.frame2={set:"idle",shape:[c.o,c.r,c.o]},invShape.idle1={set:"idle",shape:[c.t,c.p,c.t,c.t,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.t,c.t,c.p,c.t,c.p]},invShape.idle2={set:"idle",shape:[c.p,c.p,c.t,c.t,c.t,c.t,c.p,c.p,c.t,c.t,c.p,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.t,c.t,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.t,c.t,c.p,c.p,c.p]},invShape.moving1={set:"moving",shape:[c.p,c.t,c.t,c.t,c.t,c.t,c.t,c.p,c.t,c.p,c.t,c.t,c.t,c.t,c.p,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.o,c.p,c.p,c.o,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.t,c.t,c.p,c.t,c.p]},invShape.moving2={set:"moving",shape:[c.p,c.p,c.t,c.t,c.t,c.t,c.p,c.p,c.t,c.t,c.p,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.o,c.p,c.p,c.o,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.o,c.o,c.o,c.o,c.o,c.o,c.p,c.p,c.p,c.p,c.t,c.t,c.p,c.p,c.p]};var pShape={};pShape.idle1={set:"idle",shape:[c.t,c.t,c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.t,c.t,c.t,c.o,c.o,c.o,c.o,c.o]},pShape.idle2={set:"idle",shape:[c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.t,c.t,c.t,c.o,c.o,c.o,c.o,c.o,c.t,c.t]},pShape.mLeft1={set:"moving-left",shape:[c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.t,c.r,c.t,c.o,c.o,c.o,c.o,c.o,c.t,c.r]},pShape.mLeft2={set:"moving-left",shape:[c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.r,c.t,c.r,c.o,c.o,c.o,c.o,c.o,c.r,c.t]},pShape.mRight1={set:"moving-right",shape:[c.t,c.t,c.t,c.t,c.o,c.t,c.t,c.r,c.t,c.r,c.o,c.o,c.o,c.t,c.t,c.r,c.o,c.o,c.o,c.o,c.o]},pShape.mRight2={set:"moving-right",shape:[c.t,c.t,c.t,c.t,c.o,c.t,c.t,c.t,c.r,c.t,c.o,c.o,c.o,c.t,c.r,c.t,c.o,c.o,c.o,c.o,c.o]},CFG.setScreen("fixed",[375,667]);var invader=new ShapeSprite("invadder",[invShape.idle1,invShape.idle2,invShape.moving1,invShape.moving2],8,15),player=new ShapeSprite("player",[pShape.idle1,pShape.idle2,pShape.mLeft1,pShape.mLeft2,pShape.mRight1,pShape.mRight2],7,12),notice=new LabelSprite("CYL:Game Development Tools 2017","small"),title=new LabelSprite("WEB INVADERS","large"),start=new LabelSprite("Start","medium"),topScores=new LabelSprite("Top Scores","medium"),dialogue=new Dialogue([start,topScores]),menu=new Scene("menu",[invader,notice,title,dialogue,player]),level=new Scene("level",[notice,player]),game=new Game([menu,level]);game.run(),notice.y=menu.frame.height-50,notice.x=menu.frame.width/2-notice.frame.width/2,title.y=menu.frame.height/2,title.x=menu.frame.width/2-title.frame.width/2,invader.y=menu.frame.height/2-invader.frame.height,invader.x=title.x-invader.frame.width-20,player.x=menu.frame.width/2-player.frame.width/2,player.y=menu.frame.height-150,dialogue.updatePos(title.x,menu.frame.height/2),placeInvadersWith(level);var InvaderPattern=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Pattern),_createClass(t,[{key:"update",value:function(){this.cycle?(this.xMovement=Math.abs(this.xMovement),this.xProgression=this.xProgression+this.xMovement,this.xProgression>this.xMax&&(this.cycle=!1)):(this.xMovement=-Math.abs(this.xMovement),this.xProgression=this.xProgression+this.xMovement,this.xProgression<0&&(this.cycle=!0))}}]),t}(),invaderPattern=new InvaderPattern("level","invader",3,1);invaderPattern.xMax=50,game.addPatternToScene(invaderPattern);var input=new Input,action=new Action("shake"),mAction=new MouseAction("click-move"),pMAction=new MouseAction("click-move-x");invader.setAction(action),invader.setMouseAction(mAction),player.setMouseAction(pMAction),input.arrowLeft(function(){invader.actionWithVector()}),input.arrowRight(function(){invader.actionWithVector()}),input.arrowUp(function(){invader.actionWithVector(),dialogue.focusUp()}),input.arrowDown(function(){dialogue.focusDown(),invader.actionWithVector()}),input.spaceBar(function(){0===dialogue.focusIndex&&game.setActiveSceneNamed("level"),1===dialogue.focusIndex&&alert("Not yet implemented ;)")}),input.escape(function(){game.setActiveSceneNamed("menu")}),input.click(function(e){invader.mouseActionUpdate(e.x,e.y),player.mouseActionUpdate(e.x,e.y),shoot()}),invader.actionDidStart(function(){invader.setAnimation("moving")}),invader.actionDidStop(function(){invader.setAnimation("idle")}),player.actionIsRunning(function(){player.mouseAction.vectorDirection?player.setAnimation("moving-right"):player.setAnimation("moving-left")}),player.actionDidStop(function(){player.setAnimation("idle")});var BulletPattern=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Pattern),_createClass(t,[{key:"update",value:function(){}}]),t}(),bulletPattern=new BulletPattern("level","bullet",0,-4);game.addPatternToScene(bulletPattern),game.onUpdate(function(){if(void 0!==this.spriteNamed("bullet")||void 0!==this.spritesNamed("invader"))for(var e=0;e<this.spritesNamed("bullet").length;e++){if(void 0===this.spritesNamed("bullet")[e])return;for(var t=0;t<this.spritesNamed("invader").length;t++){if(void 0===this.spritesNamed("invader")[t])return;this.spritesNamed("bullet")[e].inCollisionWith(this.spritesNamed("invader")[t])&&(this.removeSprite(this.spritesNamed("invader")[t]),this.removeSprite(this.spritesNamed("bullet")[e]))}void 0!==this.spritesNamed("bullet")[e]&&this.spritesNamed("bullet")[e].y<0&&this.removeSprite(this.spritesNamed("bullet")[e])}});
//# sourceMappingURL=cyl.min.js.map