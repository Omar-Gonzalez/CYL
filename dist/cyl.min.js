"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();!function(){var t=" - Please consider getting a recent version of Firefox, Chrome or Safari";window.console.error&&window.console.warn||(alert("Your browser doesn't suppor the console.error and console.warn debug tools"+t),console.error("Your browser doesn't suppor the console.error and console.warn debug tools"+t)),!1===!!window.CanvasRenderingContext2D&&(alert("Your browser doesn't suppor Canvas 2D rendering context"+t),console.error("Your browser doesn't suppor Canvas 2D rendering context"+t)),window.requestAnimationFrame||(alert("Your browser doesn't suppor the requestAnimationFrame API"+t),console.error("Your browser doesn't suppor equestAnimationFrame API"+t)),window.addEventListener||(alert("Your browser doesn't suppor the addEventListener API"+t),console.error("Your browser doesn't suppor addEventListener API"+t))}(),console.log(requestAnimationFrame),function(t,e){function i(){if(!s){s=!0;for(var t=0;t<o.length;t++)o[t].fn.call(window,o[t].ctx);o=[]}}function n(){"complete"===document.readyState&&i()}t=t||"docReady";var o=[],s=!1,c=!1;(e=e||window)[t]=function(t,e){if("function"!=typeof t)throw new TypeError("callback for docReady(fn) must be a function");s?setTimeout(function(){t(e)},1):(o.push({fn:t,ctx:e}),"complete"===document.readyState?setTimeout(i,1):c||(document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):(document.attachEvent("onreadystatechange",n),window.attachEvent("onload",i)),c=!0))}}("docReady",window),Array.prototype.min=function(t){if(0===this.length)return null;if(1===this.length)return this[0];t=t||Math.min;for(var e=this[0],i=1;i<this.length;i++)e=t(this[i],e);return e},Array.prototype.max=function(t){if(0===this.length)return null;if(1===this.length)return this[0];t=t||Math.max;for(var e=this[0],i=1;i<this.length;i++)e=t(this[i],e);return e},Number.prototype.between=function(t,e){return this>t&&this<e},Number.prototype.positivity=function(){return this>0?"positive":"negative"},Number.prototype.getCloseTo=function(t,e){return this<t?this+e:this-e},window.SCREEN=function(){var t=10,e=[100,100];t=window.innerWidth/100;var i=void 0,n=void 0;if(e){var o=(100-e[1])/2;document.getElementById("screen").style.marginTop=o+"%",i=e[0]+"%",n=e[1]+"%"}return{pixelSize:t,screen:{width:i,height:n}}},window.addEventListener("resize",function(){window.SCREEN()}),window.DEVICE=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop"};var Action=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";_classCallCheck(this,t),"default"===e&&console.warn("CYL:Warning, Initialicing Action with default parameter"),this.kind=e,this.cycleX=!0,this.cycleY=!0,this.accelRatio=1.7,this.xCurrentSpeed=0,this.yCurrentSpeed=0,this.prevXSpeed=0,this.prevYSpeed=0,this.maxSpeedFactor=12}return _createClass(t,[{key:"computeX",value:function(t){if("default"===this.kind)return t;if("accel"===this.kind){t.positivity()!==this.prevXSpeed.positivity()&&(this.xCurrentSpeed=0),this.prevXSpeed=t;var e=void 0;return"positive"===t.positivity()?(e=t*this.maxSpeedFactor,this.xCurrentSpeed<e&&(this.xCurrentSpeed=this.xCurrentSpeed+t*this.accelRatio)):(e=-Math.abs(t*this.maxSpeedFactor),this.xCurrentSpeed>e&&(this.xCurrentSpeed=this.xCurrentSpeed+t*this.accelRatio)),this.xCurrentSpeed}return"shake"===this.kind?this.cycleX?(this.cycleX=!1,-Math.abs(this._shake(t))):(this.cycleX=!0,this._shake(t)):"shake-vertical"===this.kind?0:void 0}},{key:"computeY",value:function(t){if("default"===this.kind)return t;if("accel"===this.kind){t.positivity()!==this.prevYSpeed.positivity()&&(this.yCurrentSpeed=0),this.prevYSpeed=t;var e=void 0;return"positive"===t.positivity()?(e=t*this.maxSpeedFactor,this.yCurrentSpeed<e&&(this.yCurrentSpeed=this.yCurrentSpeed+t*this.accelRatio)):(e=-Math.abs(t*this.maxSpeedFactor),this.yCurrentSpeed>e&&(this.yCurrentSpeed=this.yCurrentSpeed+t*this.accelRatio)),this.yCurrentSpeed}return"shake"===this.kind?this.cycleY?(this.cycleY=!1,this._shake(t)):(this.cycleY=!0,-Math.abs(this._shake(t))):"shake-vertical"===this.kind?this.cycleY?(this.cycleY=!1,this._shake(t)):(this.cycleY=!0,-Math.abs(this._shake(t))):void 0}},{key:"_shake",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return Math.floor(Math.random()*t)+1}}]),t}(),MouseAction=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";_classCallCheck(this,t),"default"===e&&console.warn("CYL:Warning, Initializing Mouse Action with default parameter"),this.kind=e,this.movementRate=10,this.originX=0,this.originY=0,this.targetX=0,this.targetY=0,this.reachedTargetX=!1,this.reachedTargetY=!1}return _createClass(t,[{key:"computeX",value:function(t,e,i){return"default"===this.kind?t:"click-move"===this.kind?e.between(t-i.width/2,t+i.width/2)?(this.reachedTargetX=!0,e):e.getCloseTo(t,this.movementRate):"click-move-x"===this.kind?(this.targetX=t,this.originX=e,e.between(t-i.width/2,t+i.width/2)?(this.reachedTargetX=!0,e):e.getCloseTo(t,this.movementRate)):"click-move-y"===this.kind?e:void 0}},{key:"computeY",value:function(t,e,i){return"default"===this.kind?t:"click-move"===this.kind?e.between(t-i.height/2,t+i.height/2)?(this.reachedTargetY=!0,e):e.getCloseTo(t,this.movementRate):"click-move-x"===this.kind?e:"click-move-y"===this.kind?e.between(t-i.height/2,t+i.height/2)?(this.reachedTargetY=!0,e):e.getCloseTo(t,this.movementRate):void 0}},{key:"shouldKeepUpdating",get:function(){return"click-move-x"===this.kind&&this.reachedTargetX?(this.reachedTargetX=!1,!1):"click-move-y"===this.kind&&this.reachedTargetY?(this.reachedTargetY=!1,!1):!this.reachedTargetX||!this.reachedTargetY||(this.reachedTargetX=!1,this.reachedTargetY=!1,!1)}},{key:"vectorDirection",get:function(){return"click-move-x"===this.kind?this.originX<this.targetX:"click-move-y"===this.kind?this.originY<this.targetY:void 0}}]),t}(),Input=function(){function t(){_classCallCheck(this,t),this._registerKeyDown(),this.events=0}return _createClass(t,[{key:"_registerKeyDown",value:function(){var t=this;window.addEventListener("keydown",function(e){return t._filterKeyDown(e)}),document.getElementById("game").addEventListener(this.clickForDevice,function(e){return t.click(null,e)})}},{key:"click",value:function(t,e){t&&(this.mouseAction=t),"function"==typeof this.mouseAction&&void 0!==e?("mobile"===DEVICE()&&(e.x=e.touches[0].clientX,e.y=e.touches[0].clientY),this.mouseAction(e)):console.warn("CYL: Click action must be a function")}},{key:"_filterKeyDown",value:function(t){"ArrowUp"!==t.key&&"ArrowUp"!==t.code&&38!==t.keyCode||this.arrowUp(null,!0),"ArrowDown"!==t.key&&"ArrowDown"!==t.code&&40!==t.keyCode||this.arrowDown(null,!0),"ArrowLeft"!==t.key&&"ArrowLeft"!==t.code&&37!==t.keyCode||this.arrowLeft(null,!0),"ArrowRight"!==t.key&&"ArrowRight"!==t.code&&39!==t.keyCode||this.arrowRight(null,!0)," "!==t.key&&"Space"!==t.code&&32!==t.keyCode||this.spaceBar(null,!0),"Escape"!==t.key&&"Escape"!==t.code&&27!==t.keyCode||this.escape(null,!0),"a"!==t.key&&"A"!==t.key&&"KeyA"!==t.code&&65!==t.keyCode||this.a(null,!0),"s"!==t.key&&"S"!==t.key&&"KeyS"!==t.code&&83!==t.keyCode||this.s(null,!0),"d"!==t.key&&"D"!==t.key&&"KeyD"!==t.code&&68!==t.keyCode||this.d(null,!0),"f"!==t.key&&"F"!==t.key&&"KeyF"!==t.code&&70!==t.keyCode||this.f(null,!0),"p"!==t.key&&"P"!==t.key&&"KeyP"!==t.code&&80!==t.keyCode||this.p(null,!0)}},{key:"p",value:function(t,e){t&&(this.pAction=t),void 0!==e&&("function"==typeof this.pAction?this.pAction():this._callBackTypeError())}},{key:"f",value:function(t,e){t&&(this.fAction=t),void 0!==e&&("function"==typeof this.fAction?this.fAction():this._callBackTypeError())}},{key:"d",value:function(t,e){t&&(this.dAction=t),void 0!==e&&("function"==typeof this.dAction?this.dAction():this._callBackTypeError())}},{key:"s",value:function(t,e){t&&(this.sAction=t),void 0!==e&&("function"==typeof this.sAction?this.sAction():this._callBackTypeError())}},{key:"a",value:function(t,e){t&&(this.aAction=t),void 0!==e&&("function"==typeof this.aAction?this.aAction():this._callBackTypeError())}},{key:"escape",value:function(t,e){t&&(this.escapeAction=t),void 0!==e&&("function"==typeof this.escapeAction?this.escapeAction():this._callBackTypeError())}},{key:"spaceBar",value:function(t,e){t&&(this.spaceBarAction=t),void 0!==e&&("function"==typeof this.spaceBarAction?this.spaceBarAction():this._callBackTypeError())}},{key:"arrowUp",value:function(t,e){t&&(this.arrowUpAction=t),void 0!==e&&("function"==typeof this.arrowUpAction?(this.events++,this.arrowUpAction()):this._callBackTypeError())}},{key:"arrowDown",value:function(t,e){t&&(this.keyDownAction=t),void 0!==e&&("function"==typeof this.keyDownAction?(this.events++,this.keyDownAction()):this._callBackTypeError())}},{key:"arrowLeft",value:function(t,e){t&&(this.keyLeftAction=t),void 0!==e&&("function"==typeof this.keyLeftAction?this.keyLeftAction():this._callBackTypeError())}},{key:"arrowRight",value:function(t,e){t&&(this.keyRightAction=t),void 0!==e&&("function"==typeof this.keyRightAction?this.keyRightAction():this._callBackTypeError())}},{key:"_callBackTypeError",value:function(){console.warn("CYL: Input action requires a function")}},{key:"clickForDevice",get:function(){return"desktop"===DEVICE()?"click":"touchstart"}}]),t}(),Scene=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,t),Array.isArray(e)?e.length<1?console.error("CYL:[Exception]Need at least one sprite to initialize a scene"):(this.screen=document.getElementById("screen"),this.canvas=document.getElementById("game"),this.ctx=this.canvas.getContext("2d"),this.sprites=e,this._defineCanvasDimensions()):console.error("CYL:[Exception]Update method requires an array of sprites")}return _createClass(t,[{key:"_defineCanvasDimensions",value:function(){var t=this;this.screen.style.width=SCREEN().screen.width,this.screen.style.height=SCREEN().screen.height,this.canvas.width=this.screen.offsetWidth,this.canvas.height=this.screen.offsetHeight,window.addEventListener("resize",function(){t.screen.style.width=SCREEN().screen.width,t.screen.style.height=SCREEN().screen.height,t.canvas.width=t.screen.offsetWidth,t.canvas.height=t.screen.offsetHeight})}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.frame.width,this.frame.height);for(var t=0;t<this.sprites.length;t++)this.sprites[t].renderedX=[],this.sprites[t].renderedY=[]}},{key:"_renderPixel",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.ctx.fillStyle=e.color,this.ctx.fillRect(e.x+i,e.y+n,SCREEN().pixelSize,SCREEN().pixelSize),t.renderedX.push(e.x+i),t.renderedY.push(e.y+n)}},{key:"_renderShapeWith",value:function(t){for(var e=0;e<t.framePixels.length;e++)this._renderPixel(t,t.framePixels[e],t.x,t.y)}},{key:"_sortShapeFrameWith",value:function(t){t.tickCounter>t.tick&&(t.tickCounter=0,t.currentFrameIndex++,t.currentFrameIndex>=t.frameCount&&(t.currentFrameIndex=0)),t.tickCounter++,this._renderShapeWith(t)}},{key:"_renderBitmapFrame",value:function(t){this.ctx.drawImage(t.currentFrame,t.x,t.y,t.currentFrame.width,t.currentFrame.height)}},{key:"_sortBitmapFrameWith",value:function(t){t.tickCounter>t.tick&&(t.tickCounter=0,t.currentFrameIndex++,t.currentFrameIndex>=t.frameCount&&(t.currentFrameIndex=0)),t.tickCounter++,this._renderBitmapFrame(t)}},{key:"_renderLabelSprite",value:function(t){this.ctx.font=t.ctxFont,this.ctx.fillStyle=t.color,t.width=this.ctx.measureText(t.text).width,this.ctx.fillText(t.text,t.x,t.y)}},{key:"_renderDialogue",value:function(t){for(var e=0;e<t.options.length;e++)this._renderLabelSprite(t.options[e])}},{key:"update",value:function(){this.clear();for(var t=0;t<this.sprites.length;t++)"shape"===this.sprites[t].kind&&this._sortShapeFrameWith(this.sprites[t]),"bitmap"===this.sprites[t].kind&&this._sortBitmapFrameWith(this.sprites[t]),"label"===this.sprites[t].kind&&this._renderLabelSprite(this.sprites[t]),"dialogue"===this.sprites[t].kind&&this._renderDialogue(this.sprites[t])}},{key:"setSprites",value:function(t){Array.isArray(t)?this.sprites=t:console.error("CYL:[Exception]Update method requires an array of sprites")}},{key:"frame",get:function(){return{width:parseInt(this.canvas.width),height:parseInt(this.canvas.height)}}},{key:"assets",get:function(){return{spriteCount:this.sprites.length,sprites:this.sprites}}}]),t}(),ShapeSprite=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;_classCallCheck(this,t),void 0===e&&console.warn("CYL:Warning, no name identifier for sprite"),4===n&&console.warn("CYL:Warning, default 4 sprite size"),void 0!==i?Array.isArray(i)?(this.kind="shape",this.name=e,this.spriteFrames=[],this.width=n,this.x=c,this.y=r,this.currentFrameIndex=0,this.tick=o,this.tickCounter=0,this.shapes=i,this.activeAnimation="",this.renderedX=[],this.renderedY=[],this.contactGroup=s,this.action=null,this.constantUpdateInterval=";)",this.actionStoppedCB=null,this.setAnimation()):console.error("CYL:[Exception]Shape object must be an array"):console.error("CYL:[Exception]You need a shape to initialize a sprite")}return _createClass(t,[{key:"setAnimation",value:function(t){this.spriteFrames=[],this.activeAnimation=void 0===t?"idle":t;for(var e=0,i=0;i<this.shapes.length;i++)this.shapes[i].set===this.activeAnimation&&(this.mapFrameWith(this.shapes[i].shape),e++);0!==e?this.frameCount=e:console.error("CYL:[Exception]No active sets in srite")}},{key:"mapFrameWith",value:function(t){for(var e=[],i=0,n=0,o=0;o<t.length;o++)e.push({x:i,y:n,color:t[o]}),i+=SCREEN().pixelSize,(o+1)%this.width==0&&(n+=SCREEN().pixelSize,i=0);this.spriteFrames.push(e)}},{key:"inContactWith",value:function(t){var e=!1,i=!1;return(this.bounds.maxX.between(t.bounds.minX,t.bounds.maxX)||this.bounds.minX.between(t.bounds.minX,t.bounds.maxX))&&(e=!0),(this.bounds.maxY.between(t.bounds.minY,t.bounds.maxY)||this.bounds.minY.between(t.bounds.minY,t.bounds.maxY))&&(i=!0),!0===e&&!0===i?{inContact:!0,contactWith:this.name+" in contact with "+t.name}:{inContact:!1}}},{key:"inCollisionWith",value:function(t){var e=!1,i=!1;return(this.bounds.maxX.between(t.bounds.minX,t.bounds.maxX)||this.bounds.minX.between(t.bounds.minX,t.bounds.maxX))&&(e=!0),(this.bounds.maxY.between(t.bounds.minY,t.bounds.maxY)||this.bounds.minY.between(t.bounds.minY,t.bounds.maxY))&&(i=!0),!0===e&&!0===i?{inCollision:!0,collisionWith:this.name+" in collision with "+t.name}:{inCollision:!1}}},{key:"updatePos",value:function(t,e){this.x=t,this.y=e}},{key:"actionWithVector",value:function(t,e){this.x=this.action.computeX(t)+this.x,this.y=this.action.computeY(e)+this.y}},{key:"mouseActionWithClick",value:function(t,e,i){this.x=this.mouseAction.computeX(t-this.frame.width/2,this.x,this.frame),this.y=this.mouseAction.computeY(e-this.frame.height/2,this.y,this.frame),this.actionIsRunning(null,!0),this.mouseAction.shouldKeepUpdating||(clearInterval(this.constantUpdateInterval),this.actionDidStop(null,!0))}},{key:"mouseActionUpdate",value:function(t,e){clearInterval(this.constantUpdateInterval),this.actionDidStart(null,!0);var i=this;this.constantUpdateInterval=setInterval(function(){i.mouseActionWithClick(t,e)},40)}},{key:"actionDidStop",value:function(t,e){t&&(this.actionStoppedCB=t),void 0!==e&&("function"==typeof this.actionStoppedCB?this.actionStoppedCB():this._callBackTypeError())}},{key:"actionDidStart",value:function(t,e){t&&(this.actionStartCB=t),void 0!==e&&("function"==typeof this.actionStartCB?this.actionStartCB():this._callBackTypeError())}},{key:"actionIsRunning",value:function(t,e){t&&(this.actionIsRunning=t),void 0!==e&&("function"==typeof this.actionIsRunning?this.actionIsRunning():this._callBackTypeError())}},{key:"setAction",value:function(t){this.action=t}},{key:"setMouseAction",value:function(t){this.mouseAction=t}},{key:"_callBackTypeError",value:function(){console.warn("CYL: action cb requires a function")}},{key:"bounds",get:function(){return{maxX:this.renderedX.max(),minX:this.renderedX.min(),maxY:this.renderedY.max(),minY:this.renderedY.min()}}},{key:"frame",get:function(){return{width:parseInt(this.renderedX.max()-this.renderedX.min()),height:parseInt(this.renderedY.max()-this.renderedY.min())}}},{key:"framePixels",get:function(){return this.spriteFrames[this.currentFrameIndex]}},{key:"frames",get:function(){return this.spriteFrames}}]),t}(),BitmapSprite=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:50,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;_classCallCheck(this,t),void 0===e&&console.warn("CYL:Warning, no name identifier for sprite"),Array.isArray(i)?void 0!==i?(50===o&&50===n&&console.warn("CYL:Warning, bitmap sprite dimensions set to default 50x50"),this.kind="bitmap",this.name=e,this.bitmaps=i,this.width=n,this.height=o,this.x=r,this.y=a,this.tick=s,this.tickCounter=0,this.frameCount=0,this.currentFrameIndex=0,this.contactGroup=c,this.setAnimation()):console.error("CYL:[Exception]You need at least one bitmap to initialize a sprite"):console.error("CYL:[Exception]Bitmaps object must be an array")}return _createClass(t,[{key:"setAnimation",value:function(t){this.spriteFrames=[],this.activeAnimation=void 0===t?"idle":t;for(var e=0,i=0;i<this.bitmaps.length;i++)if(this.bitmaps[i].set===this.activeAnimation){var n=new Image;n.src=this.bitmaps[i].src,n.width=this.width,n.height=this.height,this.spriteFrames.push(n),e++}0!==e?this.frameCount=e:console.error("CYL:[Exception]No active frames in srite")}},{key:"inContactWith",value:function(t){var e=!1,i=!1;return(this.bounds.maxX.between(t.bounds.minX,t.bounds.maxX)||this.bounds.minX.between(t.bounds.minX,t.bounds.maxX))&&(e=!0),(this.bounds.maxY.between(t.bounds.minY,t.bounds.maxY)||this.bounds.minY.between(t.bounds.minY,t.bounds.maxY))&&(i=!0),!0===e&&!0===i?{inContact:!0,contactWith:this.name+" in contact with "+t.name}:{inContact:!1}}},{key:"inCollisionWith",value:function(t){var e=!1,i=!1;return(this.bounds.maxX.between(t.bounds.minX,t.bounds.maxX)||this.bounds.minX.between(t.bounds.minX,t.bounds.maxX))&&(e=!0),(this.bounds.maxY.between(t.bounds.minY,t.bounds.maxY)||this.bounds.minY.between(t.bounds.minY,t.bounds.maxY))&&(i=!0),!0===e&&!0===i?{inCollision:!0,collisionWith:this.name+" in collision with "+t.name}:{inCollision:!1}}},{key:"setDimension",value:function(t,e){this.spriteFrames=[];for(var i=0;i<this.bitmaps.length;i++)if(this.bitmaps[i].set===this.activeAnimation){var n=new Image;n.src=this.bitmaps[i].src,n.width=t,n.height=t,this.spriteFrames.push(n)}}},{key:"updatePos",value:function(t,e){this.x=t,this.y=e}},{key:"actionWithVector",value:function(t,e){this.x=this.action.computeX(t)+this.x,this.y=this.action.computeY(e)+this.y}},{key:"mouseActionWithClick",value:function(t,e,i){this.x=this.mouseAction.computeX(t-this.frame.width/2,this.x,this.frame),this.y=this.mouseAction.computeY(e-this.frame.height/2,this.y,this.frame),this.actionIsRunning(null,!0),this.mouseAction.shouldKeepUpdating||(clearInterval(this.constantUpdateInterval),this.actionDidStop(null,!0))}},{key:"mouseActionUpdate",value:function(t,e){clearInterval(this.constantUpdateInterval),this.actionDidStart(null,!0);var i=this;this.constantUpdateInterval=setInterval(function(){i.mouseActionWithClick(t,e)},40)}},{key:"actionDidStop",value:function(t,e){t&&(this.actionStoppedCB=t),void 0!==e&&("function"==typeof this.actionStoppedCB?this.actionStoppedCB():this._callBackTypeError())}},{key:"actionDidStart",value:function(t,e){t&&(this.actionStartCB=t),void 0!==e&&("function"==typeof this.actionStartCB?this.actionStartCB():this._callBackTypeError())}},{key:"actionIsRunning",value:function(t,e){t&&(this.actionIsRunning=t),void 0!==e&&("function"==typeof this.actionIsRunning?this.actionIsRunning():this._callBackTypeError())}},{key:"setAction",value:function(t){this.action=t}},{key:"setMouseAction",value:function(t){this.mouseAction=t}},{key:"_callBackTypeError",value:function(){console.warn("CYL: action cb requires a function")}},{key:"bounds",get:function(){return{maxX:this.width+this.x,minX:this.x,minY:this.y,maxY:this.height+this.y}}},{key:"currentFrame",get:function(){return this.spriteFrames[this.currentFrameIndex]}},{key:"frames",get:function(){return this.spriteFrames}}]),t}(),LabelSprite=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Verdana",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"normal",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",c=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:5),r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:30;_classCallCheck(this,t),void 0===e&&console.error("CYL:[Exception] You need a string to initalize a label sprite"),this.kind="label",this.text=e,this.font=n,this.size=i+"px",this.weight=o,this.color=s,this.width,this.x=c,this.y=r}return _createClass(t,[{key:"updatePos",value:function(t,e){this.x=t,this.y=e}},{key:"ctxFont",get:function(){return this.weight+" "+this.size+" "+this.font}},{key:"frame",get:function(){return{width:parseInt(this.width),height:parseInt(this.size)}}}]),t}(),Dialogue=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:55,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"menu",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#6A1B9A",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"white",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1.5,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:10,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:10;_classCallCheck(this,t),Array.isArray(e)?(this.name=n,this.kind="dialogue",this.x=r,this.y=a,this.lineSpace=i,this.labels=e,this.focusIndex=0,this.focusSize=parseInt(e[0].size)*c+"px",this.focusColor=o,this.defaultFontSize=e[0].size,this.defaultColor=s,this._placeGrid()):console.error("CYL:[Exception]Labbels object must be an array of LabelSprites")}return _createClass(t,[{key:"_placeGrid",value:function(){for(var t=0;t<this.labels.length;t++)this.labels[t].y=this.y+this.lineSpace+parseInt(t*this.lineSpace),this.labels[t].x=this.labels[t].x+this.x;this._processFocus()}},{key:"_processFocus",value:function(){for(var t=0;t<this.labels.length;t++)t===this.focusIndex?(this.labels[t].size=this.focusSize,this.labels[t].color=this.focusColor):(this.labels[t].size=this.defaultFontSize,this.labels[t].color=this.defaultColor)}},{key:"setFocus",value:function(t){t<0||t>this.labels.length?console.warn("CYL:[Warning] - The focus you are setting is out of range"):(this.focusIndex=t,this._processFocus())}},{key:"focusDown",value:function(){this.focusIndex>=this.labels.length-1?this.focusIndex=0:this.focusIndex++,this._processFocus()}},{key:"focusUp",value:function(){0>=this.focusIndex?this.focusIndex=this.labels.length-1:this.focusIndex--,this._processFocus()}},{key:"updatePos",value:function(t,e){this.x=t,this.y=e,this._placeGrid()}},{key:"options",get:function(){return this.labels}}]),t}(),Game=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),Array.isArray(e)?(0===e.length&&console.warn("CYL:Default initial scene with index 0 is being loaded"),this.scenes=e,this.active=i,this.shouldUpdate=!0,this.setActiveScene(),this.run=this.run.bind(this)):console.error("CYL:[Exception]Game requires an array of scenes")}return _createClass(t,[{key:"setActiveScene",value:function(t){void 0!==t&&(this.active=t),this.activeScene=this.scenes[this.active]}},{key:"run",value:function(){this.shouldUpdate&&(this.activeScene.update(),this.detectContact()),window.requestAnimationFrame(this.run)}},{key:"pause",value:function(){this.shouldUpdate?this.shouldUpdate=!1:this.shouldUpdate=!0}},{key:"spriteNamed",value:function(t){for(var e=0;e<this.activeScene.sprites.length;e++)if(this.activeScene.sprites[e].name===t)return this.activeScene.sprites[e]}},{key:"spritesNamed",value:function(t){return this.activeScene.sprites.filter(function(e){return e.name===t})}},{key:"spritesWithKind",value:function(t){return this.activeScene.sprites.filter(function(e){return e.kind===t})}},{key:"detectContact",value:function(){}},{key:"detectCollision",value:function(){}},{key:"assets",get:function(){return{scenes:this.scenes,activeScene:this.activeScene}}}]),t}(),invShape={},c={t:"transparent",p:"#6A1B9A",o:"#FF9800",r:"#FF5722"};invShape.idle1={set:"idle",shape:[c.t,c.p,c.t,c.t,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.t,c.t,c.p,c.t,c.p]},invShape.idle2={set:"idle",shape:[c.p,c.p,c.t,c.t,c.t,c.t,c.p,c.p,c.t,c.t,c.p,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.t,c.t,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.t,c.t,c.p,c.p,c.p]},invShape.moving1={set:"moving",shape:[c.p,c.t,c.t,c.t,c.t,c.t,c.t,c.p,c.t,c.p,c.t,c.t,c.t,c.t,c.p,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.o,c.p,c.p,c.o,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.t,c.p,c.t,c.t,c.p,c.t,c.p]},invShape.moving2={set:"moving",shape:[c.p,c.p,c.t,c.t,c.t,c.t,c.p,c.p,c.t,c.t,c.p,c.t,c.t,c.p,c.t,c.t,c.t,c.p,c.p,c.p,c.p,c.p,c.p,c.t,c.p,c.p,c.o,c.p,c.p,c.o,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.p,c.o,c.o,c.o,c.o,c.o,c.o,c.p,c.p,c.p,c.p,c.t,c.t,c.p,c.p,c.p]};var pShape={};pShape.idle1={set:"idle",shape:[c.t,c.t,c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.t,c.t,c.t,c.o,c.o,c.o,c.o,c.o]},pShape.idle2={set:"idle",shape:[c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.t,c.t,c.t,c.o,c.o,c.o,c.o,c.o,c.t,c.t]},pShape.mLeft1={set:"moving-left",shape:[c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.t,c.r,c.t,c.o,c.o,c.o,c.o,c.o,c.t,c.r]},pShape.mLeft2={set:"moving-left",shape:[c.t,c.t,c.o,c.t,c.t,c.t,c.t,c.t,c.o,c.o,c.o,c.r,c.t,c.r,c.o,c.o,c.o,c.o,c.o,c.r,c.t]},pShape.mRight1={set:"moving-right",shape:[c.t,c.t,c.t,c.t,c.o,c.t,c.t,c.r,c.t,c.r,c.o,c.o,c.o,c.t,c.t,c.r,c.o,c.o,c.o,c.o,c.o]},pShape.mRight2={set:"moving-right",shape:[c.t,c.t,c.t,c.t,c.o,c.t,c.t,c.t,c.r,c.t,c.o,c.o,c.o,c.t,c.r,c.t,c.o,c.o,c.o,c.o,c.o]};var invader=new ShapeSprite("invadder",[invShape.idle1,invShape.idle2,invShape.moving1,invShape.moving2],8,15),player=new ShapeSprite("player",[pShape.idle1,pShape.idle2,pShape.mLeft1,pShape.mLeft2,pShape.mRight1,pShape.mRight2],7,12),notice=new LabelSprite("CYL:Game Development Tools 2017",15),title=new LabelSprite("WEB INVADERS",60),start=new LabelSprite("Start",30),topScores=new LabelSprite("Top Scores",30),dialogue=new Dialogue([start,topScores]),menu=new Scene([invader,notice,title,dialogue,player]),level=new Scene([notice]),game=new Game([menu,level]);game.run(),notice.y=menu.frame.height-50,notice.x=menu.frame.width/2-notice.frame.width/2,title.y=menu.frame.height/2,title.x=menu.frame.width/2-title.frame.width/2,invader.y=menu.frame.height/2-invader.frame.height,invader.x=title.x-140,player.x=menu.frame.width/2-player.frame.width/2,player.y=menu.frame.height-150,dialogue.updatePos(title.x,menu.frame.height/2);var input=new Input,action=new Action("shake"),mAction=new MouseAction("click-move"),pMAction=new MouseAction("click-move-x");invader.setAction(action),invader.setMouseAction(mAction),player.setMouseAction(pMAction),input.arrowLeft(function(){invader.actionWithVector()}),input.arrowRight(function(){invader.actionWithVector()}),input.arrowUp(function(){invader.actionWithVector(),dialogue.focusUp()}),input.arrowDown(function(){dialogue.focusDown(),invader.actionWithVector()}),input.spaceBar(function(){0===dialogue.focusIndex&&alert("Not yet implemented ;)"),1===dialogue.focusIndex&&alert("Not yet implemented ;)")}),input.click(function(t){invader.mouseActionUpdate(t.x,t.y),player.mouseActionUpdate(t.x,t.y)}),invader.actionDidStart(function(){invader.setAnimation("moving")}),invader.actionDidStop(function(){invader.setAnimation("idle")}),player.actionIsRunning(function(){player.mouseAction.vectorDirection?player.setAnimation("moving-right"):player.setAnimation("moving-left")}),player.actionDidStop(function(){player.setAnimation("idle")});
//# sourceMappingURL=cyl.min.js.map